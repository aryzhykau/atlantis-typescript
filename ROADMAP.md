# Роадмап разработки Atlantis

> **Важно:** Документация по API доступна по адресу: http://localhost:8000/openapi.json

## Клиенты

- [x] **Рефакторинг DataGrid клиентов**
  - [x] Перенести DataGrid из файла лэйаута в отдельный компонент внутри фичи клиентов
  - [x] Правильное разделение ответственности между компонентами
  - [ ] Оптимизировать запросы к API
  - [x] Убрать переключатель "Активен" из таблицы клиентов (управление статусом будет на странице клиента)

- [x] **Создание страницы отдельного клиента (ClientPage)**
  - [x] Настроить React Router для навигации на страницу клиента (путь `/home/clients/:id`)
  - [x] Добавить обработчик клика по ID в DataGrid для перехода на страницу клиента
  - [x] Создать компонент страницы клиента
  - [x] Добавить запрос для получения полной информации о клиенте
  - [x] Разработать UI страницы клиента с использованием карточек для отображения данных
    - [x] Карточка с основной информацией (ФИО, контакты, дата рождения)
        - [x] Улучшить UI/UX: добавить иконки, кликабельные ссылки `tel:` и `mailto:`.
        - [x] Добавить кнопку/переключатель для активации/деактивации клиента (в соответствии с API).
    - [x] Карточка с финансовой информацией
        - [x] Добавить расчет и отображение суммы "К доплате" (разница между "Суммой для оплаты" и "Балансом", если есть долг).
    - [x] Карточка со списком студентов (перенесено на отдельную вкладку)
  - [x] Исправить проблемы с маршрутизацией
  - [x] **Вкладка "Студенты" на странице клиента:**
    - [x] Отобразить список студентов клиента (вероятно, через существующий `ClientStudentsTable` или аналогичный).
    - [x] Добавить кнопку "Добавить студента клиенту":
        - [x] Открывает модальное окно с формой `StudentForm.tsx`.
        - [x] ID текущего клиента должен передаваться в `StudentForm` автоматически и использоваться при создании студента.
        - [x] Поле выбора/ввода ID клиента в `StudentForm` должно быть скрыто, когда форма вызывается с этой страницы. (Примечание: StudentForm сейчас не имеет пропа для скрытия поля клиента, но оно и не отображается, если не передать список клиентов. Для данного случая это поведение подходит, так как Autocomplete для выбора клиента не будет инициализирован).
        - [x] Логика `handleSubmit` в `StudentForm` (через обертку в ClientPage) должна корректно создавать студента с переданным `client_id`.

## Студенты

- [x] **Улучшение UI/UX страницы списка студентов (`StudentsListPage.tsx`)**
  - [x] Добавить кнопку "Добавить студента":
    - [x] Открывает модальное окно с формой `StudentForm.tsx`.
    - [x] Поле для указания родителя-клиента должно быть реализовано через `Autocomplete` (поиск по ФИО клиента, при выборе подставляется ID) вместо ручного ввода ID.
  - [ ] **Возможность фильтровать список студентов**
    - [x] Добавить `TextField` для поиска.
    - [x] Реализована фильтрация на стороне клиента по имени, фамилии студента и имени/фамилии родителя. `DataGrid` теперь отображает отфильтрованный список `displayedStudents`.
    - [x] Добавить чекбокс "Только активные" для фильтрации по статусу студента (рядом с полем поиска).
    - [ ] Добавить `Autocomplete` (или аналогичный компонент) для поиска по ФИО, email.
    - [ ] Рассмотреть другие фильтры (например, по статусу, наличию активного абонемента).

- [ ] **Улучшение формы создания/редактирования студента (`StudentForm.tsx` или аналогичная)**
  - [ ] Перейти от динамической к статической форме (если текущая форма динамическая).
  - [ ] Добавить обработку дат для корректной отправки на бэкенд.
  - [ ] Улучшить UI/UX.
- [x] **Заменить слово студенты на ученики на UI, в коде оставить везде Student

## Тренеры

- [x] **Улучшение формы тренеров**
  - [x] 1. Анализ API и обновление интерфейсов тренеров.
  - [x] 2. Обновление RTK-query эндпоинтов для тренеров.
  - [x] 3. Создание/обновление компонента формы тренера (`TrainerForm.tsx`).
  - [x] 4. Интеграция `TrainerForm.tsx` в страницу списка тренеров (для создания и редактирования).
  - [x] 5. Реализация страницы списка тренеров (`TrainersListPage.tsx`) с DataGrid, кнопками действий (создать, редактировать, изменить статус, удалить) и фильтрацией.
  - [x] 6. Функционал активации/деактивации тренера.
  - [x] 7. Функционал удаления тренера с подтверждением.

- [x] **Реформатирование раздела тренеров**
    - [x] **1. Анализ API и обновление интерфейсов тренеров:**
        - [x] Проанализировать `openapi.json` для эндпоинтов тренеров.
        - [x] Обновить/создать интерфейсы TypeScript в `src/features/trainers/models/trainer.ts`.
    - [x] **2. Обновление RTK Query эндпоинтов для тренеров:**
        - [x] Обновить/создать эндпоинты в `src/store/apis/trainersApi.ts` (или аналогичном) в соответствии с API и новыми интерфейсами.
        - [x] Проверить и настроить теги для кеширования и инвалидации.
    - [x] **3. Обновление таблицы списка тренеров (например, `TrainersListPage.tsx`):**
        - [x] Добавить колонку "ID" (кликабельная, ведет на `/home/trainers/:trainerId`).
        - [x] Удалить действия (редактирование, удаление, изменение статуса) из таблицы.
        - [x] Убедиться, что таблица использует актуальные хуки и интерфейсы.
    - [x] **4. Создание страницы отдельного тренера (`/home/trainers/:trainerId`):**
        - [x] Настроить маршрутизацию в `App.tsx`.
        - [x] Создать компонент `TrainerPage.tsx` в `src/features/trainers/components/`.
        - [x] Реализовать загрузку данных тренера по ID.
        - [x] Добавить базовую структуру страницы: заголовок, кнопка назад.
        - [x] Реализовать систему вкладок:
            - [x] **Вкладка "Обзор":**
                - [x] Разместить карточки для основной информации о тренере (плейсхолдеры или базовая структура).
                - [x] (В будущем: кнопки для редактирования данных, изменения статуса).
            - [x] **Вкладка "Тренировки":**
                - [x] Добавить плейсхолдер (например, "Информация о тренировках будет здесь").
                - [ ] (В будущем: отображение календаря/списка тренировок).

## Общие улучшения

- [ ] **Обработка ошибок**
  - [ ] Создать единый механизм обработки ошибок от API
  - [ ] Улучшить отображение ошибок пользователю

- [ ] **Производительность**
  - [ ] Оптимизировать ререндеры компонентов
  - [ ] Внедрить мемоизацию для часто используемых данных

- [ ] **Тестирование**
  - [ ] Добавить юнит-тесты для ключевых компонентов
  - [ ] Добавить интеграционные тесты для основных пользовательских сценариев 

## Виды Тренировок

- [ ] **Разработка функционала для Видов Тренировок**
  - [x] **1. Анализ API, интерфейсы и RTK Query эндпоинты:**
    - [x] Проверить `openapi.json` на предмет эндпоинтов, связанных с видами тренировок.
    - [x] Создать или обновить TypeScript интерфейсы в `src/features/training-types/models/trainingType.ts` (или аналогичном пути).
    - [x] Создать или обновить RTK Query эндпоинты в `src/store/apis/trainingTypesApi.ts` (или аналогичном).
  - [x] **2. Форма создания/редактирования Вида Тренировки:**
    - [x] Исправить существующую форму для создания/редактирования видов тренировок (если она есть и не работает).
    - [x] Улучшить стилизацию формы.
    - [x] Улучшить компонент выбора цвета (color picker), сделать его более привлекательным и удобным.
  - [x] **3. Страница списка Видов Тренировок (если еще нет):**
    - [x] Создать страницу для отображения списка всех видов тренировок с возможностью добавления, редактирования и удаления. (Страница/компонент `TrainingTypesDataView.tsx` существует и обновлен)
    - [x] Убрать колонку "Действия" из таблицы.
    - [x] Добавить колонку "Статус" с возможностью его изменения прямо в таблице (например, используя Switch или Chip с выпадающим меню).
    - [x] Убрать колонки "Дата создания" и "Дата обновления" из таблицы (если они там есть).
    - [x] Стилизовать булевы значения в таблице (например, "Активен", "Для взрослых") с использованием `Chip`.
    - [x] Стилизовать таблицу (`DataGrid`): убраны лишние границы ячеек, настроена ширина, фон при наведении.

## Абонементы (Subscriptions)

- [ ] **Разработка функционала для Абонементов**
  - [x] **1. Анализ API, интерфейсы и RTK Query эндпоинты:**
    - [x] Проверить `openapi.json` на предмет эндпоинтов и схем, связанных с Абонементами (`Subscription`).
    - [x] Создать или обновить TypeScript интерфейсы в `src/features/subscriptions/models/subscription.ts` (или аналогичном пути).
    - [x] Создать или обновить RTK Query эндпоинты в `src/store/apis/subscriptionsApi.ts` (или аналогичном).
  - [x] **2. Форма создания/редактирования Абонемента:**
    - [x] Разработать или адаптировать компонент формы для создания и редактирования абонементов (`SubscriptionForm.tsx`).
    - [x] Реализовать логику отправки данных через RTK Query мутации.
    - [x] Продумать валидацию полей.
  - [x] **3. Страница/компонент списка Абонементов:**
    - [x] Найти или создать компонент для отображения списка абонементов (например, `SubscriptionsDataView.tsx`).
    - [x] Реализовать отображение данных с использованием `DataGrid`.
    - [x] Добавить кнопки/действия для создания, редактирования и изменения статуса абонемента (если применимо).
    - [x] Стилизовать таблицу и ее ячейки (например, булевы значения, цены).
    - [x] Привести модальное окно формы к `Dialog` как в других частях приложения.
    - [x] Стилизовать таблицу (`DataGrid`): убраны лишние границы ячеек, настроена ширина, фон при наведении.

## Календарь и Расписание (v2)

- [ ] **1. Подготовка и Общее Проектирование:**
    - [x] **Файловая структура:** Все новые компоненты, хуки, API-сервисы и интерфейсы для календаря v2 размещать в новых директориях (например, `src/features/calendar-v2/`, `src/store/apis/calendarApi-v2.ts` и т.д.), чтобы не затрагивать существующий функционал.
    - [ ] **API и Модели Данных:**
        - [x] Создать файл `calendarApi-v2.ts` (или аналогичный) и определить в нем эндпоинты для получения шаблона расписания, используя `baseApi.injectEndpoints` из `src/store/apis/api.ts`.
        - [x] Определить API эндпоинты для получения актуальных тренировок (с детализацией по студентам), также используя `injectEndpoints`.
        - [x] **Анализ структур данных API:** Актуализировать локальную копию `openapi.json` (с `http://localhost:8000/openapi.json`) и детально изучить его для определения точных структур данных (моделей), которые бэкенд будет предоставлять для шаблона расписания и актуальных тренировок.
        - [x] Продумать/обновить модели данных TypeScript для событий шаблона и актуальных тренировок, **основываясь на данных из `openapi.json`**.
    - [ ] **Общие Принципы UI/UX:**
        - [x] **Стиль:** Соблюдать минималистичный стиль, избегая излишних визуальных элементов (использовать существующую тему MUI).
        - [x] **Навигация по неделям:** Стрелки "предыдущая/следующая неделя" + `DatePicker` из MUI (выбор даты открывает содержащую ее неделю). Отображение текущего диапазона дат.
        - [x] **Временная шкала:** Вертикальная, с 06:00 до 22:00 (последний слот 22:00-23:00), часовые слоты. Тренировки начинаются в XX:00, длительность 1 час.
        - [x] **Переключатель режимов:** "Шаблон расписания" / "Актуальные тренировки" (использовать `Tabs` из MUI).

- [ ] **2. Ключевые Компоненты для Реализации (в новой директории `src/features/calendar-v2/components/` или аналогичной):**
    - [x] **`CalendarPageLayout` (или `CalendarV2Page`):** Корневой компонент страницы "Календарь v2".
        - [x] Реализация `CalendarControlsHeader` (или секции управления), включающей:
            - [x] Переключатель режимов ("Шаблон расписания" / "Актуальные тренировки").
            - [x] Элементы навигации по неделям (стрелки "назад/вперед", `DatePicker`).
        - [x] Интеграция `CalendarShell` и передача в него выбранных недели и режима.
        - [x] Управление общим состоянием страницы (выбранная неделя, текущий режим).
    - [ ] **`CalendarShell` (Оболочка/Контейнер Календаря):**
        - [x] Отображение сетки на 7 дней и временной шкалы на основе полученных данных (неделя, режим).
        - [x] **Стилизация сетки:** Переход от границ ячеек к `gap`, настройка фона ячеек и заголовков, настройка эффектов наведения.
        - [x] **Исправление типизации в `getEventsForSlot`:** Устранить проблемы с выводом типов для `TrainingTemplate` и `RealTraining` при фильтрации событий для отображения в ячейках календаря. Раскомментировать отображение событий.
        - [ ] **Интерактивность слотов:**
            - [x] Добавлен обработчик `handleSlotClick`.
            - [x] **Создание шаблона тренировки (`TrainingTemplateForm.tsx`):**
                - [x] Открытие модального окна с формой при клике на пустой слот в режиме "Шаблон расписания".
                - [x] Реализация формы с использованием `Formik`, `formik-mui` (`Autocomplete`) и `Yup`.
                - [x] Добавлены поля для выбора вида тренировки и ответственного тренера (с загрузкой данных).
                - [x] **Добавление студентов в шаблон:**
                    - [x] Добавлен `Autocomplete` для множественного выбора студентов.
                    - [x] При добавлении студента(ов) в шаблон тренировки необходимо реализовать возможность указания даты начала их участия в этом шаблоне.
                    - [x] Дата начала по умолчанию для студента(ов) должна быть текущей датой (датой создания/редактирования шаблона или датой выбранного слота - *уточнено: используется дата слота*).
                    - [x] Это потребует изменения интерфейса формы: простой `Autocomplete` для выбора студентов может быть недостаточен. Возможно, потребуется более сложный компонент для выбора студента и указания его даты старта, или дополнительное поле `DatePicker` (реализовано через FieldArray с Autocomplete и DatePicker для каждого студента).
                - [ ] (В будущем) Редактирование шаблона.
                - [ ] (В будущем) Удаление шаблона.
            - [ ] (В будущем) Создание/редактирование актуальной тренировки.
        - [ ] **Вертикальная прокрутка:** Сетка дней/времени должна быть вертикально прокручиваемой, если ее содержимое не помещается по высоте экрана, для сохранения читаемости и удобства взаимодействия с часовыми слотами.
    - [ ] **`CalendarSlot` (Компонент Временного Слота в Сетке):**
        - [ ] Отображение одной или нескольких карточек тренировок (механизм "стопки").
        - [ ] Обработка клика для создания новой тренировки (если пустой) или для открытия `Popover` (если занят).
    - [ ] **`TrainingCard` (Карточка Тренировки - базовая, для отображения в слоте/стопке):**
        - [x] Отображение основной информации: тип (название, цвет), тренер.
        - [x] Карточка должна занимать ~90-100% высоты родительского слота для подготовки к отображению "стопки" тренировок (эффект наложения).
        - [x] Цветовое кодирование по `TrainingType.color`.
        - [x] Добавлено отображение количества студентов с иконкой.
        - [ ] Для "стопки": свернутое состояние (эффект каскада).
    - [ ] **`TrainingsStackPopover` (Popover для "стопки" тренировок):**
        - [ ] Анимированное появление при клике на `CalendarSlot` со стопкой.
        - [ ] Отображение полного списка `TrainingCard` для данного слота.
        - [ ] Кнопка "Добавить тренировку" в этот слот (для режима "Шаблон").
        - [ ] Каждая `TrainingCard` в `Popover` имеет кнопку "развернуть".
    - [ ] **`TrainingDetailModal` (Модальное окно детальной информации о тренировке):**
        - [ ] Анимированное появление/увеличение из `TrainingCard`